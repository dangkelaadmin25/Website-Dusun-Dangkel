<!DOCTYPE html>
<html>
<head>
  <title>Admin Agenda Dusun</title>
  <meta charset="UTF-8">
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 40px auto; }
    input, textarea { width: 100%; padding: 8px; margin-top: 5px; margin-bottom: 15px; }
    button { padding: 10px 20px; background: #2196F3; color: #fff; border: none; cursor: pointer; }
  </style>
</head>
<body>

<h2>Login Admin</h2>

<div id="login">
  <input type="password" id="pass" placeholder="Masukkan password admin">
  <button onclick="login()">Masuk</button>
</div>

<div id="editor" style="display:none;">
  <h2>Edit Agenda Dusun</h2>

  <label>Agenda 1 - Tanggal</label>
  <input id="agenda1Date">

  <label>Agenda 1 - Judul</label>
  <input id="agenda1Title">

  <label>Agenda 2 - Tanggal</label>
  <input id="agenda2Date">

  <label>Agenda 2 - Judul</label>
  <input id="agenda2Title">

  <label>Agenda 3 - Tanggal</label>
  <input id="agenda3Date">

  <label>Agenda 3 - Judul</label>
  <input id="agenda3Title">

  <button onclick="save()">Simpan Agenda</button>
</div>

<script>
const ADMIN_PASSWORD = "gantipassword"; // ganti ini

function login() {
  if (document.getElementById("pass").value === ADMIN_PASSWORD) {
    document.getElementById("login").style.display = "none";
    document.getElementById("editor").style.display = "block";
    loadCurrentValues();
  } else {
    alert("Password salah!");
  }
}

// Muat nilai dari index.html (dibaca langsung)
function loadCurrentValues() {
  fetch("index.html")
      .then(res => res.text())
      .then(html => {
          document.getElementById("agenda1Date").value = html.match(/id="agenda1Date"[^>]*>(.*?)</)[1];
          document.getElementById("agenda1Title").value = html.match(/id="agenda1Title"[^>]*>(.*?)</)[1];

          document.getElementById("agenda2Date").value = html.match(/id="agenda2Date"[^>]*>(.*?)</)[1];
          document.getElementById("agenda2Title").value = html.match(/id="agenda2Title"[^>]*>(.*?)</)[1];

          document.getElementById("agenda3Date").value = html.match(/id="agenda3Date"[^>]*>(.*?)</)[1];
          document.getElementById("agenda3Title").value = html.match(/id="agenda3Title"[^>]*>(.*?)</)[1];
      });
}

// Simpan perubahan ke GitHub
async function save() {
  const repoOwner = "USERNAME_GITHUB_MU";
  const repoName = "NAMA_REPO";
  const filePath = "index.html";
  const token = "GITHUB_TOKEN_MU";

  let newIndex = await fetch("index.html").then(r => r.text());

  newIndex = newIndex
    .replace(/id="agenda1Date"[^>]*>.*?</, `id="agenda1Date">${agenda1Date.value}<`)
    .replace(/id="agenda1Title"[^>]*>.*?</, `id="agenda1Title">${agenda1Title.value}<`)
    .replace(/id="agenda2Date"[^>]*>.*?</, `id="agenda2Date">${agenda2Date.value}<`)
    .replace(/id="agenda2Title"[^>]*>.*?</, `id="agenda2Title">${agenda2Title.value}<`)
    .replace(/id="agenda3Date"[^>]*>.*?</, `id="agenda3Date">${agenda3Date.value}<`)
    .replace(/id="agenda3Title"[^>]*>.*?</, `id="agenda3Title">${agenda3Title.value}<`);

  const res = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`);
  const fileData = await res.json();

  await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`, {
    method: "PUT",
    headers: { "Authorization": `token ${token}` },
    body: JSON.stringify({
      message: "Update agenda",
      content: btoa(unescape(encodeURIComponent(newIndex))),
      sha: fileData.sha
    })
  });

  alert("Agenda berhasil diperbarui!");
}
</script>

</body>
</html>
